@page
@using System.Text.Json;
@using external_payments.Models;
@model external_payments.Pages.IndexModel
<style>
    .logo {
        border: 4px dashed rgb(35, 148, 253);
        border-radius: 10px;
        cursor: grab;
    }
</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>

<div class="d-flex flex-column justify-content-center align-content-center align-items-center">

    <header class="p-3">
        <h1 class="text-primary display-1 mb-5 p-3 logo" style="font-family:'Comic Sans MS';">Przelewy25</h1>
    </header>
    @{
        ViewData["Title"] = "Payment";
        // get payment id from query string
        string paymentId = Request.Query["paymentId"];

        // decode paymentId from base64 to PaymentId
        string decodedPaymentId = System.Text.Encoding.UTF8.GetString(Convert.FromBase64String(paymentId));
        TransactionId? transactionId = JsonSerializer.Deserialize<TransactionId>(decodedPaymentId);


        if (transactionId == null)
        {
            <h1>Invalid Payment Id</h1>
        }
        else
        {
            var url = Html.Raw($"'{transactionId.UrlRedirect}'");

            <script>
                function ButtonClick() {
                    alert("Hura udało się!");

                    window.location.href = @url;
                }

            </script>

            double amount = (double)transactionId.Amount / 100;
            <h1>Do zapłaty: @amount zł</h1>
            <button class="btn btn-success p-3 m-5 btn-lg" onclick="ButtonClick()"><h2>Zapłać!</h2></button>

            <a href="@transactionId.UrlRedirect" onclick="ButtonClick()">Zapłać</a>
        }
    }

</div>

